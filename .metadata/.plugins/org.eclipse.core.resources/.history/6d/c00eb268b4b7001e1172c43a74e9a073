package pizzeria_v02;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Scanner;

public class IncluirDatos {

    public static void incluyendoPizza(Connection conexion, Scanner tec) {
        System.out.println("id: ");
        int id = tec.nextInt();
        tec.nextLine();
        System.out.print("Nombre: ");
        String nombre = tec.nextLine();
        System.out.print("Ingredientes: ");
        String ingredientes = tec.nextLine();
        System.out.print("Precio: ");
        double precio = tec.nextDouble();
        tec.nextLine();

        try {
            String consultaSQL = "INSERT INTO pizza (id, nombre, ingredientes, precio) VALUES (?, ?, ?, ?)";
            try (PreparedStatement statement = conexion.prepareStatement(consultaSQL)) {
            	statement.setInt(1, id);
                statement.setString(2, nombre);
                statement.setString(3, ingredientes);
                statement.setDouble(4, precio);

                int filasAfectadas = statement.executeUpdate();

                if (filasAfectadas > 0) {
                    System.out.println("pizza agregada con éxito.");
                } else {
                    System.out.println("no se pudo agregar la pizza");
                }
            }
        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error al incluir la pizza en la base de datos.");
        } finally {
        }
    }
    
    public static void incluyendoUsuario(Connection conexion, Scanner tec) {
        System.out.println("id: ");
        int id = tec.nextInt();
        tec.nextLine();        
        System.out.print("nombre: ");
        String nombre = tec.nextLine();
        System.out.println("apellido: ");
        String apellido = tec.nextLine();

        try {
            String consultaSQL = "INSERT INTO usuario (id, nombre, apellido) VALUES (?, ?, ?)";
            try (PreparedStatement statement = conexion.prepareStatement(consultaSQL)) {
            	statement.setInt(1, id);
                statement.setString(2, nombre);
                statement.setString(3, apellido);

                int filasAfectadas = statement.executeUpdate();

                if (filasAfectadas > 0) {
                    System.out.println("usuario agregado con éxito");
                } else {
                    System.out.println("no se pudo agregar el usuario");
                }
            }
        } catch (SQLException e) {
            e.printStackTrace();
            System.out.println("Error al incluir el usuario en la base de datos.");
        } finally {
        }
    }
    
    public static void listandoPedidos(Connection conexion) {
		Statement sentencia = null;
		ResultSet resultado = null;
		
		try {
			sentencia = conexion.createStatement();
			String consultaSQL = "SELECT pe.idpedido, us.nombre, us.apellido, pi.nombre, pi.precio FROM pedido pe JOIN pizza pi ON pe.idpizza = pi.id JOIN usuario us ON pe.idusuario = us.id";
			resultado = sentencia.executeQuery(consultaSQL);
			while (resultado.next()) {
				String col01 = resultado.getString("pe.idpedido");
				String col02 = resultado.getString("us.nombre");
				String col03 = resultado.getString("us.apellido");
				String col04 = resultado.getString("pi.nombre");
				String col05 = resultado.getString("pi.precio");
				System.out.println(col01 + " " + col02 + " " + col03 + " " + col04 + " " + col05);
			}
		} catch (SQLException e) {
            e.printStackTrace();
            System.out.println("error de consulta");
        } finally {
            try {
                if (resultado != null) resultado.close();
                if (sentencia != null) sentencia.close();
            } catch (SQLException e) {
                e.printStackTrace();
                System.out.println("error al cerrar los recursos");
            }
        }
    }
    
}